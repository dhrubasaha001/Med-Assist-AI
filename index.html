<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediAssist AI - Open-Source Multi-Modal Medical AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom focus styles for better accessibility */
        .focus-ring:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Loading spinner animation */
        .spinner {
            border: 2px solid #e5e7eb;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }
        
        /* Error message styling */
        .error-message {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        /* Success message styling */
        .success-message {
            background-color: #dcfce7;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="bg-blue-100 p-2 rounded-lg mr-3">
                        <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">MediAssist AI</h1>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8">
                    <a href="#home" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-1">Home</a>
                    <a href="#text-qa" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-1">Text Q&A</a>
                    <a href="#image-analysis" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-1">Image Analysis</a>
                    <a href="#voice-input" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-1">Voice Input</a>
                    <a href="#about" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-1">About</a>
                </div>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden focus-ring rounded p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="md:hidden hidden pb-4">
                <div class="flex flex-col space-y-2">
                    <a href="#home" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-2">Home</a>
                    <a href="#text-qa" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-2">Text Q&A</a>
                    <a href="#image-analysis" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-2">Image Analysis</a>
                    <a href="#voice-input" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-2">Voice Input</a>
                    <a href="#about" class="text-gray-700 hover:text-blue-600 font-medium focus-ring rounded px-2 py-2">About</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Backend Status Indicator -->
    <div id="backend-status" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 text-center">
        <span id="status-text">Checking backend connection...</span>
    </div>

    <!-- Hero Section -->
    <section id="home" class="bg-gradient-to-r from-blue-50 to-green-50 py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
                Accessible AI-powered Health Guidance
            </h2>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8 max-w-4xl mx-auto">
                <p class="text-lg text-yellow-800">
                    <strong>Important:</strong> This tool is not a diagnostic device. Always consult a healthcare professional for medical advice.
                </p>
            </div>
            <button onclick="scrollToSection('text-qa')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-lg focus-ring transition-colors">
                Get Started
            </button>
        </div>
    </section>

    <!-- Text Q&A Section -->
    <section id="text-qa" class="py-16 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">Text Q&A</h3>
                <p class="text-gray-600 text-lg">Ask health-related questions and get AI-powered insights</p>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-6">
                <div class="mb-6">
                    <label for="question-input" class="block text-lg font-medium text-gray-700 mb-2">
                        Your Health Question
                    </label>
                    <textarea 
                        id="question-input" 
                        class="w-full p-4 border border-gray-300 rounded-lg focus-ring resize-none" 
                        rows="4" 
                        placeholder="e.g., What are the symptoms of dehydration?"
                        aria-describedby="question-help"
                    ></textarea>
                    <p id="question-help" class="text-sm text-gray-500 mt-2">
                        Ask about symptoms, general health information, or wellness tips.
                    </p>
                </div>
                
                <div class="mb-4 flex gap-3">
        <button 
            onclick="startRecording()" 
            id="record-btn"
            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg focus-ring transition-colors"
        >
            üé§ Start Recording
        </button>
        <button 
            onclick="stopRecording()" 
            id="stop-btn"
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg focus-ring transition-colors hidden"
        >
            ‚èπÔ∏è Stop Recording
        </button>
    </div>
                
                <!-- Error Display -->
                <div id="text-error" class="hidden error-message"></div>
                
                <!-- Answer Display -->
                <div id="text-answer" class="hidden mt-6 bg-white rounded-lg p-6 border border-gray-200">
                    <h4 class="text-xl font-semibold text-gray-900 mb-4">AI Response</h4>
                    <div id="answer-content" class="text-gray-700 mb-4 whitespace-pre-wrap"></div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600 mb-2">
                            <strong>Model:</strong> <span id="answer-model"></span>
                        </div>
                        <div class="text-sm text-gray-600" id="usage-info"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Image Analysis Section -->
    <section id="image-analysis" class="py-16 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">Image Analysis</h3>
                <p class="text-gray-600 text-lg">Upload medical images for AI-powered analysis</p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-4 max-w-2xl mx-auto">
                    <p class="text-sm text-yellow-800">
                        <strong>Note:</strong> Image analysis requires additional backend setup for vision models. Currently showing text-based analysis.
                    </p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg p-6">
                <div class="mb-6">
                    <label for="image-upload" class="block text-lg font-medium text-gray-700 mb-2">
                        Upload Medical Image
                    </label>
                    <input 
                        type="file" 
                        id="image-upload" 
                        accept="image/*" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus-ring"
                        onchange="previewImage()"
                    >
                    <p class="text-sm text-gray-500 mt-2">
                        Supported formats: JPG, PNG, GIF (Max 10MB)
                    </p>
                </div>
                
                <!-- Image Preview -->
                <div id="image-preview" class="hidden mb-6">
                    <h4 class="text-lg font-medium text-gray-700 mb-2">Preview</h4>
                    <div class="border border-gray-300 rounded-lg p-4 bg-gray-50">
                        <img id="preview-img" class="max-w-full h-auto max-h-64 mx-auto rounded" alt="Preview">
                    </div>
                </div>
                
                <!-- Image Description Input -->
                <div class="mb-6">
                    <label for="image-description" class="block text-lg font-medium text-gray-700 mb-2">
                        Describe what you see or your concerns about the image
                    </label>
                    <textarea 
                        id="image-description" 
                        class="w-full p-4 border border-gray-300 rounded-lg focus-ring resize-none" 
                        rows="3" 
                        placeholder="e.g., I have a mole on my arm that has changed color recently..."
                    ></textarea>
                </div>
                
                <button 
                    onclick="analyzeImage()" 
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg focus-ring transition-colors"
                    id="analyze-image-btn"
                    disabled
                >
                    Analyze Image
                </button>
                
                <!-- Loading Indicator -->
                <div id="image-loading" class="hidden mt-6 flex items-center justify-center">
                    <div class="spinner"></div>
                    <span class="ml-2 text-gray-600">Analyzing image...</span>
                </div>
                
                <!-- Error Display -->
                <div id="image-error" class="hidden error-message"></div>
                
                <!-- Analysis Result -->
                <div id="image-result" class="hidden mt-6 bg-gray-50 rounded-lg p-6 border border-gray-200">
                    <h4 class="text-xl font-semibold text-gray-900 mb-4">Analysis Result</h4>
                    <div id="image-analysis-content" class="text-gray-700 mb-4 whitespace-pre-wrap"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Voice Input Section -->
    <section id="voice-input" class="py-16 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">Voice Input</h3>
                <p class="text-gray-600 text-lg">Speak your health questions naturally</p>
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4 max-w-2xl mx-auto">
                    <p class="text-sm text-blue-800">
                        <strong>Note:</strong> Voice recognition requires HTTPS and microphone permissions. Currently supports manual text input.
                    </p>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-6">
                <div class="mb-6">
                    <label for="voice-text-input" class="block text-lg font-medium text-gray-700 mb-2">
                        Type your health question (Voice input simulation)
                    </label>
                    <textarea 
                        id="voice-text-input" 
                        class="w-full p-4 border border-gray-300 rounded-lg focus-ring resize-none" 
                        rows="4" 
                        placeholder="e.g., I've been having headaches for the past few days..."
                    ></textarea>
                </div>
                <button onclick="startListening()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg focus-ring transition-colors mb-4">
                üé§ Start Listening
            </button>
                <button 
                    onclick="analyzeVoice()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg focus-ring transition-colors"
                    id="analyze-voice-btn"
                >
                    Analyze Voice Input
                </button>
                
                <!-- Loading Indicator -->
                <div id="voice-loading" class="hidden mt-6 flex items-center justify-center">
                    <div class="spinner"></div>
                    <span class="ml-2 text-gray-600">Processing voice input...</span>
                </div>
                
                <!-- Error Display -->
                <div id="voice-error" class="hidden error-message"></div>
                
                <!-- Voice Response -->
                <div id="voice-response" class="hidden mt-6 bg-white rounded-lg p-6 border border-gray-200">
                    <h4 class="text-xl font-semibold text-gray-900 mb-4">AI Response</h4>
                    <div id="voice-interpretation" class="text-gray-700 whitespace-pre-wrap"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-16 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">About MediAssist AI</h3>
                <p class="text-gray-600 text-lg">Open-source, accessible healthcare AI for everyone</p>
            </div>
            
            <div class="bg-white rounded-lg p-8">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="text-center">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h4 class="text-xl font-semibold text-gray-900 mb-2">Accessible</h4>
                        <p class="text-gray-600">Designed with accessibility in mind, supporting various input methods and clear visual design.</p>
                    </div>
                    
                    <div class="text-center">
                        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                        </div>
                        <h4 class="text-xl font-semibold text-gray-900 mb-2">Open Source</h4>
                        <p class="text-gray-600">Built with transparency and community collaboration at its core.</p>
                    </div>
                    
                    <div class="text-center">
                        <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                            </svg>
                        </div>
                        <h4 class="text-xl font-semibold text-gray-900 mb-2">Educational</h4>
                        <p class="text-gray-600">Provides health information and guidance while emphasizing professional medical consultation.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <h4 class="text-xl font-bold mb-4">MediAssist AI</h4>
                    <p class="text-gray-400">
                        Open-source multi-modal medical AI assistant providing accessible health guidance.
                    </p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Links</h4>
                    <ul class="space-y-2">
                        <li><a href="https://github.com/dhrubasaha001/Med-Assist-AI" class="text-gray-400 hover:text-white focus-ring rounded">GitHub Repository</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white focus-ring rounded">Documentation</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white focus-ring rounded">Contributing</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Contact</h4>
                    <p class="text-gray-400 mb-4">
                        Questions or feedback? Reach out to our team.
                    </p>
                    <a href="mailto:contact@mediassist.ai" class="text-blue-400 hover:text-blue-300 focus-ring rounded">
                        contact@mediassist.ai
                    </a>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p class="text-gray-400">
                    ¬© 2024 MediAssist AI. Open source under MIT License. 
                    <strong>Disclaimer:</strong> This is not a medical device. Always consult healthcare professionals.
                </p>
            </div>
        </div>
    </footer>
    <script>
        // Configuration - Dynamic backend URL detection
        function getBackendUrl() {
            // Check if we're in development (localhost)
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:5000';
            }
            
            // For production, use environment variable or default to your deployed backend
            const backendUrl = 'https://med-assist-ai-backend-1.onrender.com';
            return backendUrl;
        }

        const API_BASE_URL = getBackendUrl();
        let backendConnected = false;

        // Check backend connection
        async function checkBackendConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                if (response.ok) {
                    const data = await response.json();
                    backendConnected = true;
                    updateBackendStatus(true, `Connected to ${data.model || 'Backend'}`);
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                console.error('Backend connection error:', error);
                backendConnected = false;
                updateBackendStatus(false, `Backend disconnected (${API_BASE_URL}) - Check if your backend is running`);
            }
        }

        // Update backend status
        function updateBackendStatus(connected, message) {
            const statusDiv = document.getElementById('backend-status');
            const statusText = document.getElementById('status-text');
            statusText.textContent = message;
            statusDiv.className = connected ? 
                'bg-green-100 border-l-4 border-green-500 text-green-700 p-4 text-center' :
                'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 text-center';
        }

        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Smooth scrolling
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        // Error handling
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function hideError(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        // API call helper with better error handling
        async function makeApiCall(prompt) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/predict`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ prompt })
                });

                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error || errorMessage;
                    } catch (e) {
                        // If response is not JSON, use the status text
                    }
                    throw new Error(errorMessage);
                }

                return await response.json();
            } catch (error) {
                console.error('API call error:', error);
                throw error;
            }
        }

        // Text Q&A
        async function submitQuestion() {
            const question = document.getElementById('question-input').value.trim();
            
            if (!question) {
                showError('text-error', 'Please enter a question first.');
                return;
            }

            hideError('text-error');
            document.getElementById('text-answer').classList.add('hidden');
            document.getElementById('text-loading').classList.remove('hidden');
            document.getElementById('submit-question-btn').disabled = true;

            try {
                if (!backendConnected) {
                    throw new Error(`Backend not connected. Please check if your backend is running at ${API_BASE_URL}`);
                }

                const data = await makeApiCall(
                    `You are a helpful medical AI assistant. Please provide informative and helpful health guidance for the following question, but always remind the user to consult healthcare professionals for medical advice: ${question}`
                );
                
                document.getElementById('answer-content').textContent = data.generated_text;
                document.getElementById('answer-model').textContent = data.model || 'AI Model';
                
                if (data.usage) {
                    document.getElementById('usage-info').innerHTML = `
                        <strong>Usage:</strong> 
                        Prompt tokens: ${data.usage.prompt_tokens || 'N/A'}, 
                        Completion tokens: ${data.usage.completion_tokens || 'N/A'}, 
                        Total tokens: ${data.usage.total_tokens || 'N/A'}
                    `;
                }
                
                document.getElementById('text-answer').classList.remove('hidden');
            } catch (error) {
                showError('text-error', `Error: ${error.message}`);
            } finally {
                document.getElementById('text-loading').classList.add('hidden');
                document.getElementById('submit-question-btn').disabled = false;
            }
        }

        // Image Analysis
        function previewImage() {
            const fileInput = document.getElementById('image-upload');
            const preview = document.getElementById('image-preview');
            const previewImg = document.getElementById('preview-img');
            const analyzeBtn = document.getElementById('analyze-image-btn');

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                    analyzeBtn.disabled = false;
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        async function analyzeImage() {
            const imageDescription = document.getElementById('image-description').value.trim();
            
            if (!imageDescription) {
                showError('image-error', 'Please describe the image or your concerns.');
                return;
            }

            hideError('image-error');
            document.getElementById('image-result').classList.add('hidden');
            document.getElementById('image-loading').classList.remove('hidden');
            document.getElementById('analyze-image-btn').disabled = true;

            try {
                if (!backendConnected) {
                    throw new Error(`Backend not connected. Please check if your backend is running at ${API_BASE_URL}`);
                }

                const data = await makeApiCall(
                    `You are a medical AI assistant analyzing a medical image description. Based on this description: "${imageDescription}", provide helpful information about potential conditions, recommendations, and emphasize the importance of consulting healthcare professionals. Important: This is not a diagnosis, only educational information.`
                );
                
                document.getElementById('image-analysis-content').textContent = data.generated_text;
                document.getElementById('image-result').classList.remove('hidden');
            } catch (error) {
                showError('image-error', `Error: ${error.message}`);
            } finally {
                document.getElementById('image-loading').classList.add('hidden');
                document.getElementById('analyze-image-btn').disabled = false;
            }
        }

        // Voice Input
        async function analyzeVoice() {
            const voiceInput = document.getElementById('voice-text-input').value.trim();
            
            if (!voiceInput) {
                showError('voice-error', 'Please enter your health question.');
                return;
            }

            hideError('voice-error');
            document.getElementById('voice-response').classList.add('hidden');
            document.getElementById('voice-loading').classList.remove('hidden');
            document.getElementById('analyze-voice-btn').disabled = true;

            try {
                if (!backendConnected) {
                    throw new Error('Backend not connected - please check your Flask server');
                }

                const data = await makeApiCall(
                    `You are a medical AI assistant. Analyze this voice input: "${voiceInput}". Provide helpful health guidance and emphasize consulting healthcare professionals. This is educational information only.`
                );
                
                // Try both possible element IDs for compatibility
                const voiceContentElement = document.getElementById('voice-interpretation') || 
                                          document.getElementById('voice-analysis-content');
                
                if (voiceContentElement) {
                    voiceContentElement.textContent = data.generated_text;
                } else {
                    console.error('Voice content element not found');
                    showError('voice-error', 'UI element not found. Please check your HTML structure.');
                    return;
                }
                
                document.getElementById('voice-response').classList.remove('hidden');
            } catch (error) {
                showError('voice-error', `Error: ${error.message}`);
            } finally {
                document.getElementById('voice-loading').classList.add('hidden');
                document.getElementById('analyze-voice-btn').disabled = false;
            }
        }

        // Web Speech API for voice recording
        let recognition;
        let isRecording = false;

        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false; // Changed to false for better control
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                recognition.maxAlternatives = 1;

                recognition.onstart = function() {
                    console.log('Voice recognition started');
                    isRecording = true;
                    updateRecordingUI(true);
                };

                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    let interimTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    const voiceInput = document.getElementById('voice-text-input');
                    if (voiceInput) {
                        voiceInput.value = (voiceInput.value || '') + finalTranscript + interimTranscript;
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    let errorMessage = 'Speech recognition error: ';
                    
                    switch(event.error) {
                        case 'no-speech':
                            errorMessage += 'No speech detected. Please try again.';
                            break;
                        case 'audio-capture':
                            errorMessage += 'Microphone not available. Please check your microphone.';
                            break;
                        case 'not-allowed':
                            errorMessage += 'Microphone permission denied. Please allow microphone access.';
                            break;
                        case 'network':
                            errorMessage += 'Network error. Please check your internet connection.';
                            break;
                        default:
                            errorMessage += event.error;
                    }
                    
                    showError('voice-error', errorMessage);
                    stopRecording();
                };

                recognition.onend = function() {
                    console.log('Voice recognition ended');
                    isRecording = false;
                    updateRecordingUI(false);
                };
            } else {
                console.warn('Speech recognition not supported in this browser');
                // Hide voice recording buttons if not supported
                const recordBtn = document.getElementById('record-btn');
                const stopBtn = document.getElementById('stop-btn');
                if (recordBtn) recordBtn.style.display = 'none';
                if (stopBtn) stopBtn.style.display = 'none';
            }
        }

        function updateRecordingUI(recording) {
            const recordBtn = document.getElementById('record-btn');
            const stopBtn = document.getElementById('stop-btn');
            
            if (recordBtn && stopBtn) {
                if (recording) {
                    recordBtn.classList.add('hidden');
                    stopBtn.classList.remove('hidden');
                    recordBtn.disabled = true;
                    stopBtn.disabled = false;
                } else {
                    recordBtn.classList.remove('hidden');
                    stopBtn.classList.add('hidden');
                    recordBtn.disabled = false;
                    stopBtn.disabled = true;
                }
            }
        }

        function startRecording() {
            if (!recognition) {
                showError('voice-error', 'Speech recognition not supported in this browser. Please type your question instead.');
                return;
            }

            if (isRecording) {
                showError('voice-error', 'Recording already in progress.');
                return;
            }

            hideError('voice-error');
            
            // Clear previous input
            const voiceInput = document.getElementById('voice-text-input');
            if (voiceInput) {
                voiceInput.value = '';
            }

            try {
                recognition.start();
            } catch (error) {
                console.error('Error starting recognition:', error);
                showError('voice-error', 'Failed to start voice recognition. Please try again.');
            }
        }

        function stopRecording() {
            if (recognition && isRecording) {
                try {
                    recognition.stop();
                } catch (error) {
                    console.error('Error stopping recognition:', error);
                }
            }
            isRecording = false;
            updateRecordingUI(false);
        }

        // Symptom Checker
        async function checkSymptoms() {
            const symptoms = document.getElementById('symptoms-input').value.trim();
            
            if (!symptoms) {
                showError('symptoms-error', 'Please enter your symptoms.');
                return;
            }

            hideError('symptoms-error');
            document.getElementById('symptoms-result').classList.add('hidden');
            document.getElementById('symptoms-loading').classList.remove('hidden');
            document.getElementById('check-symptoms-btn').disabled = true;

            try {
                if (!backendConnected) {
                    throw new Error(`Backend not connected. Please check if your backend is running at ${API_BASE_URL}`);
                }

                const data = await makeApiCall(
                    `You are a medical AI assistant helping with symptom assessment. Based on these symptoms: "${symptoms}", provide helpful information about potential conditions, when to seek medical care, and general health recommendations. Important: This is not a diagnosis - always emphasize consulting healthcare professionals for proper medical evaluation.`
                );
                
                document.getElementById('symptoms-analysis-content').textContent = data.generated_text;
                document.getElementById('symptoms-result').classList.remove('hidden');
            } catch (error) {
                showError('symptoms-error', `Error: ${error.message}`);
            } finally {
                document.getElementById('symptoms-loading').classList.add('hidden');
                document.getElementById('check-symptoms-btn').disabled = false;
            }
        }

        // Drug Information
        async function getDrugInfo() {
            const drugName = document.getElementById('drug-input').value.trim();
            
            if (!drugName) {
                showError('drug-error', 'Please enter a drug name.');
                return;
            }

            hideError('drug-error');
            document.getElementById('drug-result').classList.add('hidden');
            document.getElementById('drug-loading').classList.remove('hidden');
            document.getElementById('get-drug-info-btn').disabled = true;

            try {
                if (!backendConnected) {
                    throw new Error(`Backend not connected. Please check if your backend is running at ${API_BASE_URL}`);
                }

                const data = await makeApiCall(
                    `You are a medical AI assistant providing drug information. Provide comprehensive information about the medication: "${drugName}". Include uses, common side effects, precautions, and interactions. Always emphasize consulting healthcare professionals and pharmacists for personalized medical advice.`
                );
                
                document.getElementById('drug-info-content').textContent = data.generated_text;
                document.getElementById('drug-result').classList.remove('hidden');
            } catch (error) {
                showError('drug-error', `Error: ${error.message}`);
            } finally {
                document.getElementById('drug-loading').classList.add('hidden');
                document.getElementById('get-drug-info-btn').disabled = false;
            }
        }

        // First Aid Guide
        async function getFirstAid() {
            const situation = document.getElementById('firstaid-input').value.trim();
            
            if (!situation) {
                showError('firstaid-error', 'Please describe the emergency situation.');
                return;
            }

            hideError('firstaid-error');
            document.getElementById('firstaid-result').classList.add('hidden');
            document.getElementById('firstaid-loading').classList.remove('hidden');
            document.getElementById('get-firstaid-btn').disabled = true;

            try {
                if (!backendConnected) {
                    throw new Error(`Backend not connected. Please check if your backend is running at ${API_BASE_URL}`);
                }

                const data = await makeApiCall(
                    `You are a medical AI assistant providing first aid guidance. For the emergency situation: "${situation}", provide clear, step-by-step first aid instructions. Include when to call emergency services (911). Important: This is emergency guidance - always call emergency services for serious situations.`
                );
                
                document.getElementById('firstaid-guide-content').textContent = data.generated_text;
                document.getElementById('firstaid-result').classList.remove('hidden');
            } catch (error) {
                showError('firstaid-error', `Error: ${error.message}`);
            } finally {
                document.getElementById('firstaid-loading').classList.add('hidden');
                document.getElementById('get-firstaid-btn').disabled = false;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            checkBackendConnection();
            initializeVoiceRecognition();
            
            // Auto-check backend connection every 30 seconds
            setInterval(checkBackendConnection, 30000);
            
            // Add event listeners for Enter key
            document.getElementById('question-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitQuestion();
                }
            });

            document.getElementById('voice-text-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    analyzeVoice();
                }
            });

            document.getElementById('symptoms-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkSymptoms();
                }
            });

            document.getElementById('drug-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    getDrugInfo();
                }
            });

            document.getElementById('firstaid-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    getFirstAid();
                }
            });
        });
    </script>
</body>
</html>
